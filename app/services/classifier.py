"""
Feedback Classification Service for Arenadata Feedback System
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤ –ø–æ —Å—Ä–æ—á–Ω–æ—Å—Ç–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
"""

import re
from typing import Dict, Any, Optional
from app.schemas import FeedbackCreate


class FeedbackClassifier:
    """–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ—Ç–∑—ã–≤–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª"""
    
    def __init__(self):
        # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ä–æ—á–Ω–æ—Å—Ç–∏
        self.urgency_keywords = {
'high': [
    # üö® –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´
    '–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', '–Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è', '–Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è', '—É–ø–∞–ª', '–ª–µ–∂–∏—Ç', 
    '–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', '–æ—Ç–∫–ª—é—á–∏–ª—Å—è', '—Å–ª–æ–º–∞–ª–æ—Å—å', '–≤—ã–ª–µ—Ç–µ–ª–æ', '–∑–∞–≤–∏—Å–ª–æ', '–∑–∞–≤–∏—Å–∞–Ω–∏–µ',
    '–æ—à–∏–±–∫–∞', '–±–∞–≥', '–≥–ª—é–∫', '—Å–±–æ–π', '–ø—Ä–æ–±–ª–µ–º–∞', 'crash', 'error', 'bug', 
    'failed', 'failure', 'exception', 'timeout', '500', '503', '–æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞',
    '–ø–æ–≤—Ä–µ–∂–¥–µ–Ω', '–∫–æ—Ä—Ä—É–ø—Ü–∏—è', 'corrupt', 'corruption',
    
    # ‚è∞ –°–†–û–ß–ù–û–°–¢–¨ –ò –í–ê–ñ–ù–û–°–¢–¨
    '—Å—Ä–æ—á–Ω–æ', '–æ—á–µ–Ω—å —Å—Ä–æ—á–Ω–æ', '–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ', '–∫—Ä–∏—Ç–∏—á–Ω–æ', '–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π', 
    '–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è', '–∞–≤–∞—Ä–∏—è', '–∞–≤–∞—Ä–∏–π–Ω—ã–π', '—á—Ä–µ–∑–≤—ã—á–∞–π–Ω—ã–π',
    'emergency', 'urgent', 'critical', 'p0', 'p1', '–±–ª–æ–∫–∏—Ä—É–µ—Ç', '–±–ª–æ–∫–∏—Ä—É—é—â–∏–π',
    'blocking', 'blocker', '–≤–∞–∂–Ω–æ', '–æ—á–µ–Ω—å –≤–∞–∂–Ω–æ', '–≤–∞–∂–Ω–µ–π—à–∏–π', 'important',
    '—Ç—Ä–µ–±—É–µ—Ç—Å—è', '–Ω—É–∂–Ω–æ —Å–µ–π—á–∞—Å', '–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å—Ä–æ—á–Ω–æ',
    
    # üí∞ –ë–ò–ó–ù–ï–°-–í–û–ó–î–ï–ô–°–¢–í–ò–ï
    '–ø–æ—Ç–µ—Ä—è –¥–µ–Ω–µ–≥', '—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏', '—É–±—ã—Ç–∫–∏', '–∫–ª–∏–µ–Ω—Ç —É—Ö–æ–¥–∏—Ç', 
    '–æ—Ç–∫–∞–∑ –æ—Ç —É—Å–ª—É–≥–∏', '—Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ', '–ø—Ä–æ—Å—Ç–æ–π', '–ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞', 
    '–æ—Å—Ç–∞–Ω–æ–≤–∫–∞', '–Ω–µ –º–æ–∂–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å', '—Ä–∞–±–æ—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞', '–¥–µ–¥–ª–∞–π–Ω', 
    '—Å–æ—Ä–≤–∞–Ω —Å—Ä–æ–∫', '–ø—Ä–æ—Å—Ä–æ—á–∫–∞', '–ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö', '–¥–∞–Ω–Ω—ã–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã',
    
    # üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨
    '–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', '—É—è–∑–≤–∏–º–æ—Å—Ç—å', 'vulnerability', '–≤–∑–ª–æ–º', '—Ö–∞–∫', 'hack', 
    'security', '—É—Ç–µ—á–∫–∞', 'leak', '–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å', '–ø–∞—Ä–æ–ª—å', '–¥–æ—Å—Ç—É–ø', 
    '–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', 'authentication',
    
    # üìä –î–ê–ù–ù–´–ï –ò –û–¢–ß–ï–¢–ù–û–°–¢–¨
    '–æ—Ç—á–µ—Ç –Ω–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è', '–¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è', '—ç–∫—Å–ø–æ—Ä—Ç', '–∏–º–ø–æ—Ä—Ç', 
    'backup', '–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ', '–ø–æ—Ç–µ—Ä—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏', '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è',
    '–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', '–æ—à–∏–±–æ—á–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã',
    
    # üö´ –ù–ï–ì–ê–¢–ò–í–ù–´–ï –≠–ú–û–¶–ò–ò
    '—É–∂–∞—Å–Ω–æ', '–∫–æ—à–º–∞—Ä', '–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞', 'disaster', '–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ', '–Ω–µ–ø—Ä–∏–µ–º–ª–µ–º–æ',
    '–Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ', '—Ç—Ä–µ–±—É—é', '–Ω–∞—Å—Ç–∞–∏–≤–∞—é', '–∂–∞–ª–æ–±–∞', '–ø—Ä–µ—Ç–µ–Ω–∑–∏—è', '—Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω',
    '–∑–ª—é—Å—å', '—Å–µ—Ä–¥–∏—Ç', 'angry', 'furious', '–ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑', '—É—Ö–æ–∂—É', '–æ—Ç–∫–∞–∑—ã–≤–∞—é—Å—å'
            ],
'medium': [
    '–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ', '—É–ª—É—á—à–∏—Ç—å', '–¥–æ–±–∞–≤–∏—Ç—å', '–∏–∑–º–µ–Ω–∏—Ç—å',
    'suggestion', 'improve', 'feature', '—Ö–æ—Ç–µ–ª–æ—Å—å –±—ã',
    
    # –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
    '–º–µ–¥–ª–µ–Ω–Ω–æ', '—Ç–æ—Ä–º–æ–∑–∏—Ç', '–ª–∞–≥–∞–µ—Ç', '–¥–æ–ª–≥–æ –≥—Ä—É–∑–∏—Ç',
    '–ø–æ–¥—Ç–æ—Ä–º–∞–∂–∏–≤–∞–µ—Ç', 'slow', 'laggy', 'sluggish',
    
    # –ü—Ä–æ–±–ª–µ–º—ã —Å —É–¥–æ–±—Å—Ç–≤–æ–º
    '–Ω–µ—É–¥–æ–±–Ω–æ', '—Å–ª–æ–∂–Ω–æ', '–Ω–µ–ø–æ–Ω—è—Ç–Ω–æ', '–∑–∞–ø—É—Ç–∞–Ω–Ω–æ',
    '–Ω–µ–ª–æ–≥–∏—á–Ω–æ', '–Ω–µ–∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ', 'complicated', 'confusing',
    
    # –ß–∞—Å—Ç–∏—á–Ω—ã–µ —Å–±–æ–∏
    '–∏–Ω–æ–≥–¥–∞', '–≤—Ä–µ–º–µ–Ω–∞–º–∏', '–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏', '–∏–∑—Ä–µ–¥–∫–∞',
    '–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ', '–ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è', '–æ–±—Ä—ã–≤–∞–µ—Ç—Å—è', 'intermittent',
    
    # –û—à–∏–±–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    '–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', '–Ω–µ–≤–µ—Ä–Ω–æ', '–æ—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö', 'wrong data',
    '–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ —Ç–æ', '—Ä–∞—Å—á–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π', 'calculation error',
    
    # –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
    '–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç', '–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ', '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ', 'limitation',
    '–Ω–µ–ª—å–∑—è —Å–¥–µ–ª–∞—Ç—å', '–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ', 'cannot do',
    
    # –í–æ–ø—Ä–æ—Å—ã
    '–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å', '–ø–æ—á–µ–º—É —Ç–∞–∫', '–∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'how to',
    '–Ω–µ —É–≤–µ—Ä–µ–Ω', '—Å–æ–º–Ω–µ–≤–∞—é—Å—å', '—É—Ç–æ—á–Ω–∏—Ç—å', 'clarification',
    
    # –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —ç–º–æ—Ü–∏–∏ (–Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ)
    '—Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç', '–Ω–∞–¥–æ–µ–ª–æ', '—É—Ç–æ–º–ª—è–µ—Ç', 'annoying',
    '–Ω–µ –æ—á–µ–Ω—å', '–º–æ–≥–ª–æ –±—ã –±—ã—Ç—å –ª—É—á—à–µ', 'could be better',
    '—Ä–∞—Å—Å—Ç—Ä–æ–µ–Ω', '–Ω–µ–¥–æ–≤–æ–ª–µ–Ω', 'disappointed'
],

'low': [
    '–≤–æ–ø—Ä–æ—Å', '—Å–ø—Ä–∞–≤–∫–∞', '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', '–ø–æ–¥—Å–∫–∞–∂–∏—Ç–µ',
    'question', 'info', 'help', '–∫–∞–∫',
    
    # –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π
    '–±—ã–ª–æ –±—ã –∑–¥–æ—Ä–æ–≤–æ', '–±—ã–ª–æ –±—ã —É–¥–æ–±–Ω–æ', '–±—ã–ª–æ –±—ã –ø–æ–ª–µ–∑–Ω–æ',
    'could be great', 'would be nice', 'useful feature',
    '–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å', '–º–æ–∂–Ω–æ –≤–Ω–µ–¥—Ä–∏—Ç—å', 'suggest adding',
    '—Ö–æ—Ç–µ–ª–æ—Å—å –±—ã –≤–∏–¥–µ—Ç—å', '–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∏–º–µ—Ç—å', 'would like to see',
    
    # –ò–¥–µ–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
    '–∏–¥–µ—è', '–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ', 'suggestion', 'idea',
    '–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å', '–º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å', 'can improve',
    '–≤–æ–∑–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å', 'potential improvement',
    '–≤ –±—É–¥—É—â–µ–º', '–≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö', 'in future',
    
    # –£–ª—É—á—à–µ–Ω–∏—è UX/UI
    '—É–¥–æ–±—Å—Ç–≤–æ', '—É–ª—É—á—à–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞', 'UX improvement',
    '–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è', '–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å', 'optimize',
    '–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è', '–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å', 'automate',
    '—É–ø—Ä–æ—Å—Ç–∏—Ç—å', '—Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ—â–µ', 'simplify',
    '–≤–∏–∑—É–∞–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ', 'visual improvement',
    
    # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    '–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è', 'documentation', 'manual', 'guide',
    '–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è', 'tutorial', 'how-to guide', 'instruction',
    '—Å–ø—Ä–∞–≤–∫–∞', '–ø–æ–º–æ—â—å', 'assistance', 'support',
    '–æ–±—É—á–µ–Ω–∏–µ', 'training', 'education', 'onboarding',
    '–ø—Ä–∏–º–µ—Ä—ã', 'samples', 'examples', '–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏',
    
    # –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–¥–±–µ–∫ —Å –∏–¥–µ—è–º–∏
    '–Ω—Ä–∞–≤–∏—Ç—Å—è, –Ω–æ', 'like it but', '—Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ, –Ω–æ',
    'works well but', '—Å–ø–∞—Å–∏–±–æ, –∏', 'thank you and',
    '–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º, –∏', 'enjoy using and',
    '–æ—Ç–ª–∏—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –∏', 'great system and',
    
    # –ú–µ–ª–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è
    '–º–µ–ª–æ—á—å', '–Ω–µ–±–æ–ª—å—à–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞', 'minor improvement',
    '–Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ', '–Ω–µ —Å—Ä–æ—á–Ω–æ', 'not urgent',
    '–∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ', 'cosmetic change',
    '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏', 'customization', '–Ω–∞—Å—Ç—Ä–æ–π–∫–∞',
    'personalization', '–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è', '–∞–¥–∞–ø—Ç–∞—Ü–∏—è',
    
    # –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    '–∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —É–∑–Ω–∞—Ç—å', '–≤–æ–∑–º–æ–∂–Ω–æ –ª–∏', 'is it possible',
    '—Ö–æ—á—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å', 'want to suggest', 'would like to propose',
    '–¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏', 'for your information', 'fyi',
    '–æ–±—Ä–∞—â–∞—é –≤–Ω–∏–º–∞–Ω–∏–µ', 'note that', 'attention to',
    '–≤–æ–ø—Ä–æ—Å –Ω–µ —Å—Ä–æ—á–Ω—ã–π', 'non-urgent question',
    
    # –û–±—â–∏–µ —Å–ª–æ–≤–∞ –¥–ª—è –±—ç–∫–ª–æ–≥–∞
    '—É–ª—É—á—à–µ–Ω–∏–µ', 'enhancement', '–Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª', 'new feature',
    '—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ', 'extension', '–º–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è', 'modernization',
    '–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ', 'update', '–≤–µ—Ä—Å–∏—è', 'version', 'release'
]
        }
        
        # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–±–ª–µ–º
        self.category_keywords = {
            'bug': [
                '–æ—à–∏–±–∫–∞', '–±–∞–≥', '–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', '–æ—à–∏–±–∫–∞', '–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ',
                'bug', 'error', 'wrong', 'broken', 'crash'
            ],
            'api': [
                'api', 'endpoint', '–∑–∞–ø—Ä–æ—Å', '–æ—Ç–≤–µ—Ç', 'json', 'rest',
                'authentication', 'token', 'key', 'curl'
            ],
            'documentation': [
                '–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è', 'docs', '—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ', '–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è',
                '–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ', '–ø—Ä–∏–º–µ—Ä', 'tutorial', 'guide'
            ],
            'performance': [
                '–º–µ–¥–ª–µ–Ω–Ω–æ', '–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å', '—Å–∫–æ—Ä–æ—Å—Ç—å', '–∑–∞–≤–∏—Å–∞–µ—Ç',
                'slow', 'performance', 'lag', 'freeze', 'timeout'
            ],
            'ui_ux': [
                '–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å', '—É–¥–æ–±—Å—Ç–≤–æ', '–¥–∏–∑–∞–π–Ω', '–∫–Ω–æ–ø–∫–∞', '–º–µ–Ω—é',
                'ui', 'ux', 'interface', 'design', 'button'
            ],
            'feature_request': [
                '–¥–æ–±–∞–≤–∏—Ç—å', '–Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è', '—Ñ–∏—á–∞', '–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å',
                'feature', 'add', 'new function', 'capability'
            ],
            'other': []
        }
    
    def classify_urgency(self, text: str, form_type: str) -> str:
        """
        –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ä–æ—á–Ω–æ—Å—Ç—å –æ—Ç–∑—ã–≤–∞
        
        Args:
            text: –¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞
            form_type: –¢–∏–ø —Ñ–æ—Ä–º—ã
            
        Returns:
            –£—Ä–æ–≤–µ–Ω—å —Å—Ä–æ—á–Ω–æ—Å—Ç–∏ (high, medium, low, normal)
        """
        if not text:
            return 'normal'
        
        text_lower = text.lower()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—Å–æ–∫–æ–π —Å—Ä–æ—á–Ω–æ—Å—Ç–∏ (–≤–∫–ª—é—á–∞—è –±—ã–≤—à–∏–µ critical —Å–ª–æ–≤–∞)
        for keyword in self.urgency_keywords['high']:
            if keyword in text_lower:
                return 'high'
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–µ–¥–Ω–µ–π —Å—Ä–æ—á–Ω–æ—Å—Ç–∏
        for keyword in self.urgency_keywords['medium']:
            if keyword in text_lower:
                return 'medium'
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∏–∑–∫–æ–π —Å—Ä–æ—á–Ω–æ—Å—Ç–∏
        for keyword in self.urgency_keywords['low']:
            if keyword in text_lower:
                return 'low'
        
        # –°—Ä–æ—á–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–æ—Ä–º
        default_urgency = {
            'tech': 'medium',
            'business': 'normal', 
            'exec': 'high'
        }
        
        return default_urgency.get(form_type, 'normal')
    
    def classify_category(self, text: str, form_type: str) -> str:
        """
        –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø—Ä–æ–±–ª–µ–º—ã
        
        Args:
            text: –¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞
            form_type: –¢–∏–ø —Ñ–æ—Ä–º—ã
            
        Returns:
            –ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø—Ä–æ–±–ª–µ–º—ã
        """
        if not text:
            return 'other'
        
        text_lower = text.lower()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        for category, keywords in self.category_keywords.items():
            if category == 'other':
                continue
                
            for keyword in keywords:
                if keyword in text_lower:
                    return category
        
        return 'other'
    
    def extract_tags(self, text: str) -> list:
        """
        –ò–∑–≤–ª–µ—á—å —Ç–µ–≥–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞
        
        Args:
            text: –¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞
            
        Returns:
            –°–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤
        """
        if not text:
            return []
        
        tags = []
        text_lower = text.lower()
        
        # –ü–æ–∏—Å–∫ —Ö—ç—à—Ç–µ–≥–æ–≤
        hashtags = re.findall(r'#(\w+)', text)
        tags.extend(hashtags)
        
        # –ü–æ–∏—Å–∫ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤/—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
        tech_keywords = [
            'postgresql', 'mysql', 'redis', 'docker', 'kubernetes',
            'python', 'javascript', 'react', 'vue', 'angular',
            'api', 'rest', 'graphql', 'websocket', 'microservice'
        ]
        
        for keyword in tech_keywords:
            if keyword in text_lower:
                tags.append(keyword)
        
        # –ü–æ–∏—Å–∫ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤–µ—Ä—Å–∏–π
        versions = re.findall(r'v\d+\.\d+(\.\d+)?', text_lower)
        tags.extend(versions)
        
        return list(set(tags))  # –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–µ–≥–∏
    
    def calculate_priority_score(self, urgency: str, category: str, form_type: str) -> int:
        """
        –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –±–∞–ª–ª
        
        Args:
            urgency: –£—Ä–æ–≤–µ–Ω—å —Å—Ä–æ—á–Ω–æ—Å—Ç–∏
            category: –ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø—Ä–æ–±–ª–µ–º—ã
            form_type: –¢–∏–ø —Ñ–æ—Ä–º—ã
            
        Returns:
            –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –±–∞–ª–ª (0-100)
        """
        urgency_scores = {
            'critical': 90,
            'high': 70,
            'medium': 50,
            'low': 30,
            'normal': 20
        }
        
        category_scores = {
            'bug': 20,
            'api': 15,
            'performance': 15,
            'ui_ux': 10,
            'documentation': 5,
            'feature_request': 5,
            'other': 0
        }
        
        form_type_scores = {
            'tech': 10,
            'exec': 8,
            'business': 5
        }
        
        score = (
            urgency_scores.get(urgency, 20) +
            category_scores.get(category, 0) +
            form_type_scores.get(form_type, 5)
        )
        
        return min(score, 100)  # –ú–∞–∫—Å–∏–º—É–º 100 –±–∞–ª–ª–æ–≤
    
    def classify_feedback(self, feedback_data: FeedbackCreate) -> Dict[str, Any]:
        """
        –ü–æ–ª–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ç–∑—ã–≤–∞
        
        Args:
            feedback_data: –î–∞–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤–∞
            
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
        """
        text = feedback_data.problem_text or ""
        
        urgency = self.classify_urgency(text, feedback_data.form_type)
        category = self.classify_category(text, feedback_data.form_type)
        tags = self.extract_tags(text)
        priority_score = self.calculate_priority_score(urgency, category, feedback_data.form_type)
        
        return {
            'urgency': urgency,
            'category': category,
            'tags': tags,
            'priority_score': priority_score,
            'classification_confidence': 'high' if urgency == 'critical' else 'medium'
        }


# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
classifier = FeedbackClassifier()


def classify_feedback(feedback_data: FeedbackCreate) -> Dict[str, Any]:
    """
    –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ—Ç–∑—ã–≤–∞
    
    Args:
        feedback_data: –î–∞–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤–∞
        
    Returns:
        –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
    """
    return classifier.classify_feedback(feedback_data)
